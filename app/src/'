<template>
    <div>
        <h1>Выберете учбеное заведение и группу</h1>
        <form @submit.prevent>
            <select name="select_school" v-model="school_id" @change="selectClass">
                <option disabled value="">Учебное заведение</option>
                <option v-for="school in schools" :key="school.school_id" :value="school.school_id">{{ school.name }}</option>
            </select>
            <input @input="selectClass" type="number" placeholder="Class number" v-model="class_number">
            <input @input="selectClass" type="text" placeholder="Class letter" v-model="class_letter">
        </form>
    </div>
</template>

<script>
export default {
    data() {
        return {
            schools: [],
            class_id: "",
            school_id: "",
            class_number: "",
            class_letter: "",
        }
    },
    methods: {
        async selectClass() {
            var res = await fetch("https://dev.lava-land.ru/api/school/" + this.school_id+ "/class");
            if (res.status == 200){
                var json_res = await res.json();
                var classes = json_res['classes'];
                var find_any = false;
                for (var i = 0; i < classes.length; i++){
                    if ((this.class_number == classes[i]['number']) && (this.class_letter == classes[i]['letter'])){
                        this.class_id = classes[i]['class_id'];
                        find_any = true;
                    }
                } 
                if (!find_any){
                    this.class_id = "";
                }
            }
            this.$emit('select', this.class_id);
        },
        async loadSchools() {
             var res = await fetch("https://dev.lava-land.ru/api/school");
            if (res.status == 200){
                var json_res = await res.json();
                this.schools = json_res['schools'];
            }
        }
    },
    created() {
        this.loadSchools();
    }
}
</script>

<style>
</style>
